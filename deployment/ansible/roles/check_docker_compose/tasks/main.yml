---
- name: Ensure Docker service is started
  ansible.builtin.systemd:
    name: docker
    state: started
    enabled: true

- name: Check if Docker Compose stack is running
  community.docker.docker_compose_v2:
    project_src: /home/ec2-user/
    state: present
  register: docker_compose_status

- name: Start Docker Compose stack if not running
  community.docker.docker_compose_v2:
    project_src: /home/ec2-user/docker-compose.yml
    state: present
  when: not docker_compose_status.changed
